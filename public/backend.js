function drawChart(){chart=new google.visualization.ColumnChart(document.getElementById("chart_div")),piechart=new google.visualization.PieChart(document.getElementById("piechart")),sitesChart(),browserChart()}function browserChart(t){var e;e=google.visualization.arrayToDataTable(!t||t.length<2?[["Browser","Users"],["Unknown",0]]:t);var i={title:"Browsers",animation:{duration:500,easing:"out"}};piechart.draw(e,i)}function sitesChart(t){var e;e=google.visualization.arrayToDataTable(!t||t.length<2?[["Sites","Users"],["Unknown",0]]:t);var i={title:"Sites by User",hAxis:{title:"Site",titleTextStyle:{color:"black"}},animation:{duration:500,easing:"out"},vAxis:{minValue:0,maxValue:25},showValue:!0},r=new google.visualization.DataView(e);r.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"}]),chart.draw(r,i)}var mapOptions={center:new google.maps.LatLng(39.5,-35),zoom:2},sitelist=[],browserlist=[],chart,browserchart,map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),styles=[{featureType:"landscape",stylers:[{saturation:-100},{visibility:"simplified"}]}];map.setOptions({styles:styles}),google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(drawChart),$(function(){function t(t){var e,i=[],r=[];t.sort();for(var o=0;o<t.length;o++)t[o]!==e?(i.push(t[o]),r.push(1)):r[r.length-1]++,e=t[o];return[i,r]}function e(t){output=[["Site","Users"]];for(var e=0;e<t[0].length;e++)output.push([t[0][e],t[1][e]]);return output}var i=io(document.location.host,{multiplex:!1,path:"/socket.io"}),r=new Object,o=new Object;i.emit("bc"),i.on("ui",function(){}),i.on("ubv",function(t){for(var e in t.creatives)if(creative=t.creatives[e],"undefined"!=typeof r[t.id]&&"number"==typeof creative.visible){if(creative.visible>0){var i=r[t.id].get("icon");i.fillColor="green",i.strokeColor="green",i.fillOpacity=creative.visible,r[t.id].set("icon",i)}if(creative.visible<=0){var i=r[t.id].get("icon");i.strokeColor="red",i.fillColor="red",i.fillOpacity=.05,r[t.id].set("icon",i)}}}),i.on("uj",function(i){function a(t){var e=30,i=window.setInterval(function(){e--;var r=t.get("icon");r.strokeWeight=e,t.set("icon",r),1>=e&&clearInterval(i)},15)}$("#TotalUsers").text(i.total);var s={icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.05,fillColor:"#ff0000",strokeOpacity:1,strokeColor:"#ff0000",strokeWeight:30,scale:5},map:map,position:new google.maps.LatLng(i.latitude,i.longitude)};r[i.id]=new google.maps.Marker(s),"undefined"!=typeof r[i.id]&&a(r[i.id]),o[i.id]={site:i.site},sitelist.push(i.site),o[i.id].browser=i.browser,browserlist.push(i.browser),chartSites=t(sitelist),chartdata=e(chartSites),sitesChart(chartdata),chartBrowser=t(browserlist),browserData=e(chartBrowser),browserChart(browserData)}),i.on("ul",function(i){function a(t){var e=t.get("icon"),i=30,r=window.setInterval(function(){i--,e.strokeWeight=i,e.strokeColor="#000000",t.set("icon",e),0>=i&&(clearInterval(r),t.setMap(null))},20)}"undefined"==typeof o[i.suid]&&console.log(i.suid+" didn't register."),$("#TotalUsers").text(i.susers),sitelist.splice(sitelist.indexOf(o[i.suid].site),1),chartSites=t(sitelist),chartdata=e(chartSites),sitesChart(chartdata),browserlist.splice(sitelist.indexOf(o[i.suid].browser),1),chartBrowser=t(browserlist),browserData=e(chartBrowser),browserChart(browserData),"undefined"!=typeof r[i.suid]&&a(r[i.suid])})});
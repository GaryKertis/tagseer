function drawChart(){chart=new google.visualization.ColumnChart(document.getElementById("chart_div")),piechart=new google.visualization.PieChart(document.getElementById("piechart")),sitesChart(),browserChart()}function browserChart(e){var t;t=google.visualization.arrayToDataTable(!e||e.length<2?[["Browser","Users"],["Unknown",0]]:e);var i={title:"Browsers",animation:{duration:500,easing:"out"}};piechart.draw(t,i)}function sitesChart(e){var t;t=google.visualization.arrayToDataTable(!e||e.length<2?[["Sites","Users"],["Unknown",0]]:e);var i={title:"Sites by User",hAxis:{title:"Site",titleTextStyle:{color:"black"}},animation:{duration:500,easing:"out"},vAxis:{minValue:0,maxValue:25},showValue:!0},o=new google.visualization.DataView(t);o.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"}]),chart.draw(o,i)}var mapOptions={center:new google.maps.LatLng(39.5,-35),zoom:2},sitelist=[],browserlist=[],userData=new Object,chart,browserchart,map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),styles=[{featureType:"landscape",stylers:[{saturation:-100},{visibility:"simplified"}]}];map.setOptions({styles:styles}),google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(drawChart),$(function(){function e(e){var t,i=[],o=[];e.sort();for(var a=0;a<e.length;a++)e[a]!==t?(i.push(e[a]),o.push(1)):o[o.length-1]++,t=e[a];formatted=[i,o],output=[["Site","Users"]];for(var a=0;a<formatted[0].length;a++)output.push([formatted[0][a],formatted[1][a]]);return output}function t(){sitesChart(e(sitelist)),browserChart(e(browserlist))}var i=io(document.location.host,{multiplex:!1,path:"/socket.io"}),o=new Object;i.emit("bc"),i.on("ui",function(){}),i.on("ubv",function(e){for(var t in e.creatives)if(creative=e.creatives[t],"undefined"!=typeof o[e.id]&&"number"==typeof creative.visible){if(creative.visible>0){var i=o[e.id].get("icon");i.fillColor="green",i.strokeColor="green",i.fillOpacity=creative.visible,o[e.id].set("icon",i)}if(creative.visible<=0){var i=o[e.id].get("icon");i.strokeColor="red",i.fillColor="red",i.fillOpacity=.05,o[e.id].set("icon",i)}}}),i.on("uj",function(e){function i(e){var t=30,i=window.setInterval(function(){t--;var o=e.get("icon");o.strokeWeight=t,e.set("icon",o),1>=t&&clearInterval(i)},15)}$("#TotalUsers").text(e.total);var a={icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.05,fillColor:"#ff0000",strokeOpacity:1,strokeColor:"#ff0000",strokeWeight:30,scale:5},map:map,position:new google.maps.LatLng(e.latitude,e.longitude)};o[e.id]=new google.maps.Marker(a),"undefined"!=typeof o[e.id]&&i(o[e.id]),userData[e.id]={site:e.site},sitelist.push(e.site),userData[e.id].browser=e.browser,browserlist.push(e.browser),t()}),i.on("ul",function(e){function i(e){var t=e.get("icon"),i=30,o=window.setInterval(function(){i--,t.strokeWeight=i,t.strokeColor="#000000",e.set("icon",t),0>=i&&(clearInterval(o),e.setMap(null))},20)}"undefined"==typeof userData[e.suid]&&console.log(e.suid+" didn't register."),$("#TotalUsers").text(e.susers),sitelist.splice(sitelist.indexOf(userData[e.suid].site),1),browserlist.splice(browserlist.indexOf(userData[e.suid].browser),1),t(),"undefined"!=typeof o[e.suid]&&i(o[e.suid])})});
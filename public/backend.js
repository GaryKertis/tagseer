function drawChart(){chart=new google.visualization.ColumnChart(document.getElementById("chart_div")),piechart=new google.visualization.PieChart(document.getElementById("piechart")),updateCharts()}function browserChart(t){var e;e=google.visualization.arrayToDataTable(!t||t.length<2?[["Browser","Users"],["Unknown",0]]:t);var o={title:"Browsers",animation:{duration:500,easing:"out"}};piechart.draw(e,o)}function sitesChart(t){var e;e=google.visualization.arrayToDataTable(!t||t.length<2?[["Sites","Users"],["Unknown",0]]:t);var o={title:"Sites by User",hAxis:{title:"Site",titleTextStyle:{color:"black"}},animation:{duration:500,easing:"out"},vAxis:{minValue:0,maxValue:25},showValue:!0},i=new google.visualization.DataView(e);i.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"}]),chart.draw(i,o)}var mapOptions={center:new google.maps.LatLng(39.5,-35),zoom:2},sitelist=[],browserlist=[],userData=new Object,chart,browserchart,map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),styles=[{featureType:"landscape",stylers:[{saturation:-100},{visibility:"simplified"}]}];map.setOptions({styles:styles}),google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(drawChart),$(function(){function t(t){var e,o=[],i=[];t.sort();for(var a=0;a<t.length;a++)t[a]!==e?(o.push(t[a]),i.push(1)):i[i.length-1]++,e=t[a];formatted=[o,i],output=[["Site","Users"]];for(var a=0;a<formatted[0].length;a++)output.push([formatted[0][a],formatted[1][a]]);return output}function e(){sitesChart(t(sitelist)),browserChart(t(browserlist))}var o=io(document.location.host,{multiplex:!1,path:"/socket.io"}),i=new Object;o.emit("bc"),o.on("uj",function(t){function o(e){var o=30;if("number"==typeof t.creatives.v){if(console.log(t.creatives.v),t.creatives.v>0){var i=e.get("icon");i.fillColor="green",i.strokeColor="green",i.strokeOpacity=t.creatives.v,i.fillOpacity=t.creatives.v}if(t.creatives.v<=0){var i=e.get("icon");i.strokeColor="red",i.fillColor="red",i.fillOpacity=.05}}var a=window.setInterval(function(){o--;var t=e.get("icon");t.strokeWeight=o,e.set("icon",t),1>=o&&clearInterval(a)},15)}$("#TotalUsers").text(t.total);var a={icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.05,fillColor:"blue",strokeOpacity:1,strokeColor:"blue",strokeWeight:30,scale:5},map:map,position:new google.maps.LatLng(t.latitude,t.longitude)};i[t.id]=new google.maps.Marker(a),"undefined"!=typeof i[t.id]&&o(i[t.id]),userData[t.id]={site:t.site},sitelist.push(t.site),userData[t.id].browser=t.browser,browserlist.push(t.browser),e()}),o.on("ul",function(t){function o(t){var e=t.get("icon"),o=30,i=window.setInterval(function(){o--,e.strokeWeight=o,e.strokeColor="#000000",t.set("icon",e),0>=o&&(clearInterval(i),t.setMap(null))},20)}"undefined"==typeof userData[t.suid]&&console.log(t.suid+" didn't register."),$("#TotalUsers").text(t.susers),sitelist.splice(sitelist.indexOf(userData[t.suid].site),1),browserlist.splice(browserlist.indexOf(userData[t.suid].browser),1),e(),"undefined"!=typeof i[t.suid]&&o(i[t.suid])})});